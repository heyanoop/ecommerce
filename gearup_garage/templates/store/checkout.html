{% extends 'base.html' %}
{% load static %}

{% block content %}

<section class="section-content padding-y bg">
    <div class="container">
        <div class="row">
            <aside class="col-lg-6">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title mb-4">Billing Address</h4>
                        <button type="button" class="btn btn-success" data-toggle="collapse" data-target="#addAddressForm">Add New Address</button>
                        <div id="addAddressForm" class="collapse mt-3">
                            <form name="addressForm" action="{% url 'add_address' %}" method="POST" onsubmit="return validateForm()">
                                {% csrf_token %}
                                <!-- Address form fields -->
                                <div class="form-row">
                                    <div class="col-md-6">
                                        <label for="">First Name</label>
                                        <input type="text" name="first_name" class="form-control">
                                        <small id="first_name_error" class="text-danger"></small>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="">Last Name</label>
                                        <input type="text" name="last_name" class="form-control">
                                        <small id="last_name_error" class="text-danger"></small>
                                    </div>
                                </div>
                                <!-- Add other form rows as needed -->
                                <button type="submit" class="btn btn-primary mt-3">Add Address</button>
                            </form>
                        </div>
                        <!-- Existing addresses -->
                        {% if addresses %}
                        <form action="{% url 'place_order' %}" method="POST">
                            {% csrf_token %}
                            {% for address in addresses %}
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="radio" name="address" id="address{{ address.id }}" value="{{ address.id }}" required>
                                <label class="form-check-label" for="address{{ address.id }}">
                                    {{ address.first_name }} {{ address.last_name }}, 
                                    <!-- Display address details -->
                                </label>
                            </div>
                            {% endfor %}
                            <!-- Payment method dropdown -->
                            <div class="form-group">
                                <label for="payment_method">Payment Method</label>
                                <select name="payment_method" id="payment_method" class="form-control" required>
                                    <option value="">Select Payment Method</option>
                                    <option value="cash on Delivery">Cash On Delivery</option>
                                    <option value="debit_card">Payment Gateway</option>
                                </select>
                            </div>
                            <!-- Place order button -->
                            <button type="submit" class="btn btn-primary btn-block">Place Order</button>
                        </form>
                        {% endif %}
                    </div>
                </div>
            </aside>

            <!-- Card to display order summary -->
            <aside class="col-lg-6">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title mb-4">Order Summary</h4>
                        <!-- Display coupon details -->
                        <p>Coupon Used: {{ coupon.code }}</p>
                        <!-- Display original price and discount -->
                        <p>Original Price: {{ original_price }}</p>
                        <p>Tax: {{ tax }}</p>
                        <p>Coupon Discount: {{ coupon_discount }}</p>
                        <p>Final Price: {{ final_price }}</p>
                        <!-- Add any other relevant order summary details here -->
                    </div>
                </div>
            </aside>
        </div> <!-- row.// -->
    </div>
</section>

{% endblock  %}

<script>
    // Function to validate the form
    function validateForm() {
        // Retrieve form fields
        var firstName = document.forms["addressForm"]["first_name"].value;
        var lastName = document.forms["addressForm"]["last_name"].value;
        // Add validation for other fields as needed

        // Simple validation checks
        if (firstName == "" || lastName == "" /* Add other validation conditions */) {
            alert("All fields must be filled out");
            return false;
        }
        return true;
    }
</script>
